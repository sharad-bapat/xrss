function loading(){$(".content").html(""),$(".content").html('\n        <div class="d-flex align-items-center">\n            <strong>Loading...</strong>\n            <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div>\n        </div>\n    ')}async function fetchURL(url){const response=await fetch(url),text=await response.text();try{const data=JSON.parse(text);return{success:1,urlfetched:url,data:data}}catch(err){return{success:0,urlfetched:url,error:err,response:text}}}function imgError(image){$(image).attr("src","placeholder.jpg")}function getCustomRSS(url){loading();var n=2;return new Promise((resolve,reject)=>{try{var urls=[`https://sbcors.herokuapp.com/https://feedly.com/v3/streams/contents?streamId=${url}&count=50&ranked=newest&similar=true&findUrlDuplicates=true&ck=1656137019447&ct=feedly.desktop&cv=31.0.1621`];async.map(urls,(async function(url){try{const response=await fetch(url);return response.json()}catch(err){return{}}}),(err,results)=>{if(err)console.log(err);else{for(index in arr=[],results)console.log(results[index].title),results[index].items&&results[index].items.forEach(item=>{let title=item.title?item.title:"",link=item.canonicalUrl?item.canonicalUrl:"",content=item.summary?item.summary.content:"",published=item.published?item.published:"",media=item.visual?item.visual.url:"";arr.push({title:title,link:link,content:content,published:published,media:media})}),arrr=arr.sort((function(a,b){return b.published-a.published}));resolve(arrr)}})}catch(err){reject(err)}})}function populateCustomRSS(data){console.log(data),$(".content").html(""),$.each(data,(function(k,v){try{var{hostname:hostname}=new URL(v.link),$listItem=$(`<div class="col">\n                <div class="card h-100 shadow-sm border-0" style="cursor:pointer!important">\n                    <img src="${v.media}" loading="lazy" class="card-img-top border-0" alt="" style="max-height:150px;object-fit:cover;height:145px!important;" onerror='imgError(this)' >\n                    <div class="card-body">\n                        <small class="small mb-0">${hostname}</small>\n                        <details><summary class="fw-bold text-dark">${v.title}</summary><small class="small text-dark">${v.content} <a href="${v.link}">Read More...</a></small></details>                                                  \n                    </div>\n                </div>\n            </div>`);$(".content").append($listItem)}catch(err){$(".content").html("<strong class='text-danger'>Sorry! This RSS did not return a valid response</strong>"),console.clear()}}))}function autocomplete(inp){var currentFocus;function addActive(x){if(!x)return!1;removeActive(x),currentFocus>=x.length&&(currentFocus=0),currentFocus<0&&(currentFocus=x.length-1),x[currentFocus].classList.add("autocomplete-active")}function removeActive(x){for(var i=0;i<x.length;i++)x[i].classList.remove("autocomplete-active")}function closeAllLists(elmnt){for(var x=document.getElementsByClassName("autocomplete-items"),i=0;i<x.length;i++)elmnt!=x[i]&&elmnt!=inp&&x[i].parentNode.removeChild(x[i])}inp.addEventListener("input",(function(e){console.log(this.value);var a,b,i,val=this.value;if(closeAllLists(),!val)return!1;currentFocus=-1,(a=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),a.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(a),urls=[`https://sbcors.herokuapp.com/https://feedly.com/v3/search/feeds?q=${val}&n=9&withWebsite=true&autocomplete=true&fullTerm=false&locale=en&ck=1656138724473&ct=feedly.desktop&cv=31.0.1621`],val.length>=3&&async.mapLimit(urls,1,(async function(url){try{const response=await fetch(url);return response.json()}catch(err){return{}}}),(err,arr)=>{for(console.log(arr[0].results),i=0;i<arr[0].results.length;i++)(b=document.createElement("DIV")).innerHTML=`<img src="${arr[0].results[i].visualUrl}" style="object-fit:cover;max-height:30px;max-width:30px" class="me-2 p-2"/>`+"<strong>"+arr[0].results[i].title+"</strong>",b.innerHTML+="<input type='hidden' value='"+arr[0].results[i].title+"'>",b.innerHTML+="<input type='hidden' value='"+arr[0].results[i].feedId+"'>",b.addEventListener("click",(function(e){inp.value=this.getElementsByTagName("input")[0].value,$(".content").html(this.getElementsByTagName("input")[0].value),getCustomRSS(this.getElementsByTagName("input")[1].value).then(data=>{populateCustomRSS(data)}),closeAllLists()})),a.appendChild(b)})})),inp.addEventListener("keydown",(function(e){var x=document.getElementById(this.id+"autocomplete-list");x&&(x=x.getElementsByTagName("div")),40==e.keyCode?(currentFocus++,addActive(x)):38==e.keyCode?(currentFocus--,addActive(x)):13==e.keyCode&&(e.preventDefault(),currentFocus>-1&&x&&x[currentFocus].click())})),document.addEventListener("click",(function(e){closeAllLists(e.target)}))}autocomplete(document.getElementById("searchBox"));